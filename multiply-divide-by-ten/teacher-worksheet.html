<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Teacher Worksheet — Multiply & Divide by Powers of 10</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Schoolbell&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#fff;
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#2563eb;

      /* default PV sizing (screen) */
      --pvw: 30px;
      --pvh: 44px;
      --pvBorder:#cfd6f3;
      --pvLabel:#6b7280;
      --pvDigit:#0b72b9;
      --pvDecBg:#f1f1f1;

      --shadow:0 12px 30px rgba(15, 23, 42, 0.12);
      --radius:18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(circle at top left, #eef1ff, #f5f7fb 50%, #f0f4ff 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:var(--ink);
      padding:18px;
    }

    .app{
      max-width: 1100px;
      margin: 0 auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,0.03);
    }

    /* Banner */
    .banner{
      padding: 18px 18px 14px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.92));
    }
    .banner-title{
      font-family: "Schoolbell","Kalam",cursive;
      font-size: 2.1rem;
      letter-spacing: 0.3px;
      margin: 0 0 6px;
    }
    .banner-sub{
      margin:0 0 14px;
      color: var(--muted);
      font-weight: 600;
    }

    .controls{
      display:flex;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
      border: 1px solid #e8ecff;
      background:#fbfcff;
      border-radius: 14px;
      padding: 12px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 260px;
    }
    .field label{
      font-size: 0.92rem;
      color: var(--muted);
      font-weight: 800;
    }
    select, input{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #d7ddff;
      background:#fff;
      font-size: 1rem;
      outline:none;
    }
    select:focus, input:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(147,197,253,0.25);
    }

    .actions{
      margin-left:auto;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      border:none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 1rem;
      font-weight: 900;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background: var(--accent);
      color:#fff;
      box-shadow: 0 6px 16px rgba(37,99,235,0.25);
    }
    .btn.secondary{
      background:#eef2ff;
      color:#111827;
      border: 1px solid #d7ddff;
    }
    .btn.danger{
      background:#ffe8e8;
      color:#7f1d1d;
      border: 1px solid #ffbcbc;
    }

    /* Pages area */
    .pages{
      padding: 16px 18px 8px;
      background:#fff;
    }

    /* Each printed page wrapper */
    .sheet{
      background:#fff;
      border-radius: 14px;
      border: 1px solid #eef2ff;
      padding: 14px 14px 10px;
      margin-bottom: 14px;
    }

    /* Student header (worksheet pages) */
    .student-header{
      border: 1px solid #e8ecff;
      background: #fbfcff;
      border-radius: 14px;
      padding: 10px 12px;
      margin-bottom: 10px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    .student-title{
      font-family: "Schoolbell","Kalam",cursive;
      font-size: 1.6rem;
      font-weight: 900;
      line-height: 1;
    }
    .student-fields{
      font-weight: 900;
      color:#111827;
      display:flex;
      gap: 14px;
      flex-wrap:wrap;
      align-items:center;
    }
    .line{
      display:inline-block;
      min-width: 180px;
      border-bottom: 2px solid #111827;
      height: 18px;
      vertical-align:bottom;
    }

    .sheet-title{
      margin:0 0 10px;
      font-size: 1.05rem;
      color:#111827;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-weight: 900;
    }
    .sheet-title .meta{
      color: var(--muted);
      font-weight:800;
      font-size:0.95rem;
    }

    /* STRICT 2x6 grid */
    .grid-2x6{
      display:grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: repeat(6, auto);
      gap: 10px 16px;
      align-items: start;
    }

    .q{
      border: 1px solid #edf0ff;
      background:#fbfcff;
      border-radius: 14px;
      padding: 10px 10px 12px;
      min-height: 122px;

      break-inside: avoid;
      page-break-inside: avoid;
    }

    /* centred PV + statement under it */
    .q-top{
      display: grid;
      grid-template-columns: 34px 1fr;
      align-items: start;
      column-gap: 10px;
    }
    .q-num{
      font-weight: 1000;
      color:#111827;
      min-width: 34px;
    }

    .pv-mini-wrap{
      justify-self: center;
      max-width: 100%;
      overflow:hidden;
      border-radius: 12px;
      background:#ffffff;
      border: 1px solid #dbe2ff;
      padding: 6px;
    }

    /* Mini PV grid */
    .pv-grid{ display:inline-block; }
    .pv-row{ display:flex; }
    .pv-cell{
      width: var(--pvw);
      height: var(--pvh);
      border: 1px solid var(--pvBorder);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
    }
    .pv-cell.decimal{
      width: 18px;
      min-width: 18px;
      background: var(--pvDecBg);
      border-left:none;
      border-right:none;
      font-weight:900;
      color:#6b7280;
    }
    .pv-labels .pv-cell{
      height: 34px;
      font-size: 0.55rem;
      color: var(--pvLabel);
      border-bottom:none;
    }
    .pv-label-text{
      display:inline-block;
      transform: rotate(-90deg);
      transform-origin:center;
      white-space:nowrap;
      opacity:0.95;
    }
    .pv-digits .pv-cell{
      border-top:none;
      font-size: 1.05rem;
      font-weight: 1000;
      color: var(--pvDigit);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .pv-digits .pv-cell.decimal{
      color:#9ca3af;
      font-weight:1000;
    }

    .expr{
      margin-top: 10px;
      font-family: "Schoolbell","Kalam",cursive;
      font-size: 1.9rem;
      line-height: 1.05;
      color:#111827;
      display:flex;
      justify-content: center;
      align-items:center;
      flex-wrap:wrap;
      gap: 8px;
      text-align: center;
      width: 100%;
    }

    .box{
      display:inline-block;
      width: 90px;
      height: 44px;
      border: 3px solid #111827;
      border-radius: 10px;
      background:#fff;
      vertical-align:middle;
    }

    .answer-pill{
      font-weight: 1000;
      padding: 6px 10px;
      border-radius: 10px;
      border: 2px solid #111827;
      background:#fff;
      display:inline-block;
      min-height: 38px;
    }

    .empty-state{
      padding: 18px 6px 6px;
      text-align:center;
      color: var(--muted);
      font-weight:800;
    }

    /* Bottom banner */
    .bottom-banner{
      text-align:center;
      padding: 10px 0 12px;
      color: #374151;
      font-weight: 900;
      border-top: 1px solid #eef2ff;
      background: #fbfcff;
    }
    .bottom-banner a{
      color:#2563eb;
      text-decoration:none;
      font-weight: 1000;
    }
    .bottom-banner a:hover{ text-decoration:underline; }

    /* PRINT FIXES */
    @page{
      size: A4;
      margin: 10mm;
    }

    @media print{
      body{ background:#fff; padding:0; }
      .app{ box-shadow:none; border:none; border-radius:0; }
      .banner, .controls{ display:none !important; }
      .pages{ padding:0; }

      /* FORCE 2 columns and prevent overflow */
      .grid-2x6{
        display: grid !important;
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important;
        grid-template-rows: repeat(6, auto) !important;
        gap: 8px 12px !important;
      }

      .sheet{
        border:none;
        border-radius:0;
        margin:0;
        padding: 0;
        page-break-after: always;
      }
      .sheet:last-of-type{ page-break-after: auto; }

      .sheet-title{ padding: 0 0 6px; font-size: 0.98rem; }
      .student-header{
        border: none;
        background: transparent;
        border-radius: 0;
        padding: 0 0 6px;
        margin: 0 0 6px;
      }

      .q{
        background:#fff;
        border:none;
        padding: 6px 4px 8px;
        min-height: 112px;
      }

      /* shrink PV for print */
      :root{
        --pvw: 26px;
        --pvh: 40px;
      }
      .pv-cell.decimal{
        width: 14px;
        min-width: 14px;
      }
      .pv-labels .pv-cell{
        height: 30px;
        font-size: 0.52rem;
      }
      .pv-digits .pv-cell{
        font-size: 0.98rem;
      }

      .expr{
        font-size: 1.65rem;
        margin-top: 8px;
        gap: 6px;
      }
      .box{
        width: 78px;
        height: 40px;
      }

      .pv-mini-wrap{
        border: 1px solid #d1d5db;
        padding: 5px;
      }

      .bottom-banner{
        border-top: 1px solid #d1d5db;
        background:#fff;
      }
    }

    @media (max-width: 920px){
      .actions{ margin-left:0; }
      .field{ min-width: 240px; }
    }

    /* screen-only responsiveness (print will never collapse to 1 column) */
    @media screen and (max-width: 820px){
      .grid-2x6{ grid-template-columns: 1fr; grid-template-rows: none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="banner">
      <div class="banner-title">Multiply & divide by tens worksheet generator</div>
      <p class="banner-sub">Generate printable A4 worksheets + a completed answer key.</p>

      <div class="controls" aria-label="worksheet controls">
        <div class="field">
          <label for="levelSel">Level</label>
          <select id="levelSel">
            <option value="ten">Level 1 — × / ÷ 10</option>
            <option value="hundred">Level 2 — × / ÷ 100</option>
            <option value="thousand">Level 3 — × / ÷ 1000</option>
            <option value="mixed">Level 4 — Mixed</option>
            <option value="reverse">Level 5 — Reverse challenge</option>
            <option value="mixedHarder">Level 6 — Mixed harder (50% reverse + 50% mixed)</option>
          </select>
        </div>

        <div class="field" style="min-width:220px; max-width:260px;">
          <label for="countInput">Number of questions</label>
          <input id="countInput" type="number" min="2" max="120" step="1" value="24" />
        </div>

        <div class="actions">
          <button class="btn primary" id="genBtn" type="button">Generate worksheet</button>
          <button class="btn secondary" id="printBtn" type="button">Print (Ctrl+P)</button>
          <button class="btn danger" id="resetBtn" type="button">Reset</button>
        </div>
      </div>
    </div>

    <div class="pages" id="pages">
      <div class="empty-state">
        Choose a level and number of questions, then click <strong>Generate worksheet</strong>.
      </div>
    </div>

    <div class="bottom-banner">
      Mills Maths Tools – <a href="https://www.millsmathstools.com" target="_blank" rel="noopener noreferrer">www.millsmathstools.com</a>
    </div>
  </div>

<script>
  const operationsPool = [
    { steps: 1, mult: true,  label: "× 10"   },
    { steps: 1, mult: false, label: "÷ 10"   },
    { steps: 2, mult: true,  label: "× 100"  },
    { steps: 2, mult: false, label: "÷ 100"  },
    { steps: 3, mult: true,  label: "× 1000" },
    { steps: 3, mult: false, label: "÷ 1000" }
  ];

  const LEVEL_LABELS = {
    ten: "Level 1 — × / ÷ 10",
    hundred: "Level 2 — × / ÷ 100",
    thousand: "Level 3 — × / ÷ 1000",
    mixed: "Level 4 — Mixed",
    reverse: "Level 5 — Reverse challenge",
    mixedHarder: "Level 6 — Mixed harder"
  };

  const PV_LEFT  = ["millions","hundred-thousands","ten-thousands","thousands","hundreds","tens","ones"];
  const PV_RIGHT = ["tenths","hundredths","thousandths","ten-thousandths"];
  const MAX_RIGHT_DIGITS = PV_RIGHT.length;

  const PER_PAGE = 12; // 2 x 6 strict

  const levelSel = document.getElementById("levelSel");
  const countInput = document.getElementById("countInput");
  const genBtn = document.getElementById("genBtn");
  const printBtn = document.getElementById("printBtn");
  const resetBtn = document.getElementById("resetBtn");
  const pages = document.getElementById("pages");

  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function normalizeValue(v){
    if (!isFinite(v)) return v;
    const INT_EPS = 1e-12;
    const nearestInt = Math.round(v);
    if (nearestInt !== 0 && Math.abs(v - nearestInt) < INT_EPS) return nearestInt;
    return v;
  }

  function formatNumber(value){
    let s = value.toFixed(6);
    s = s.replace(/\.?0+$/, "");
    if (s === "") s = "0";

    let [intPart, fracPart=""] = s.split(".");
    intPart = intPart.replace(/^0+/, "") || "0";
    intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    return fracPart ? `${intPart}.${fracPart}` : intPart;
  }

  function chooseOperationForMode(mode){
    const candidates = [];
    if (mode === "ten") {
      operationsPool.forEach(op => { if (op.steps === 1) candidates.push(op); });
    } else if (mode === "hundred") {
      operationsPool.forEach(op => { if (op.steps === 2) candidates.push(op); });
    } else if (mode === "thousand") {
      operationsPool.forEach(op => { if (op.steps === 3) candidates.push(op); });
    } else {
      operationsPool.forEach(op => candidates.push(op));
    }
    const pick = candidates[randInt(0, candidates.length - 1)];
    return { steps: pick.steps, mult: pick.mult, label: pick.label };
  }

  function getDigitInfo(value){
    let s = value.toFixed(MAX_RIGHT_DIGITS);
    if (!s.includes(".")) s += ".";
    let [intPart, fracPart] = s.split(".");
    intPart = intPart.replace(/^0+/, "") || "0";
    fracPart = (fracPart || "").padEnd(MAX_RIGHT_DIGITS, "0").slice(0, MAX_RIGHT_DIGITS);
    return { left: intPart.split(""), right: fracPart.split("") };
  }

  function renderPV(value){
    const { left, right } = getDigitInfo(value);
    const leftCells = new Array(PV_LEFT.length).fill("");
    const rightCells = new Array(PV_RIGHT.length).fill("");

    for (let i = 0; i < left.length; i++){
      const targetIndex = leftCells.length - 1 - i;
      if (targetIndex < 0) break;
      leftCells[targetIndex] = left[left.length - 1 - i];
    }
    for (let i = 0; i < Math.min(right.length, rightCells.length); i++){
      rightCells[i] = right[i];
    }

    let html = `<div class="pv-grid">`;

    html += `<div class="pv-row pv-labels">`;
    PV_LEFT.forEach(name => html += `<div class="pv-cell"><span class="pv-label-text">${name}</span></div>`);
    html += `<div class="pv-cell decimal"></div>`;
    PV_RIGHT.forEach(name => html += `<div class="pv-cell"><span class="pv-label-text">${name}</span></div>`);
    html += `</div>`;

    html += `<div class="pv-row pv-digits">`;
    leftCells.forEach(d => html += `<div class="pv-cell">${d || ""}</div>`);
    html += `<div class="pv-cell decimal">.</div>`;
    rightCells.forEach(d => html += `<div class="pv-cell">${d || ""}</div>`);
    html += `</div>`;

    html += `</div>`;
    return html;
  }

  function generateOriginalAndFinal(op, reverseMode){
    const maxAttempts = 220;
    for (let attempt = 0; attempt < maxAttempts; attempt++){
      const base = randInt(1, 999);
      const exp  = randInt(-2, 3);
      let value = base * Math.pow(10, exp);
      value = normalizeValue(parseFloat(value.toFixed(3)));

      if (!isFinite(value) || value <= 0) continue;
      if (value >= 10000000) continue;

      const factor = Math.pow(10, op.steps);

      let original, final;
      if (!reverseMode) {
        original = value;
        final = normalizeValue(op.mult ? original * factor : original / factor);
      } else {
        original = op.mult ? normalizeValue(value / factor) : normalizeValue(value * factor);
        final = value;
      }

      if (!isFinite(original) || !isFinite(final) || original <= 0 || final <= 0) continue;
      if (original >= 10000000 || final >= 10000000) continue;

      return { original, final };
    }

    const original = 1.44;
    const factor = Math.pow(10, op.steps);
    const final = op.mult ? original * factor : original / factor;
    return { original, final };
  }

  function buildQuestion(levelMode){
    let modeForThis = levelMode;
    if (levelMode === "mixedHarder") {
      modeForThis = (Math.random() < 0.5) ? "reverse" : "mixed";
    }

    const op = chooseOperationForMode(modeForThis);
    const reverseMode = (modeForThis === "reverse");
    const { original, final } = generateOriginalAndFinal(op, reverseMode);

    const sign = op.mult ? "×" : "÷";
    const factor = Math.pow(10, op.steps);

    let displayParts;
    let answer;

    if (!reverseMode) {
      displayParts = { kind: "endBox", leftText: `${formatNumber(original)} ${sign} ${factor} =` };
      answer = final;
    } else {
      displayParts = { kind: "startBox", midText: `${sign} ${factor} = ${formatNumber(final)}` };
      answer = original;
    }

    const pvVal = reverseMode ? final : original;
    return { pvVal, displayParts, answer };
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function chunk(arr, size){
    const out = [];
    for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));
    return out;
  }

  function renderSheets(levelMode, count){
    const n = Math.max(2, Math.min(120, count|0));
    const levelText = LEVEL_LABELS[levelMode] || "—";

    const questions = [];
    for (let i = 0; i < n; i++) questions.push(buildQuestion(levelMode));

    const pagesQ = chunk(questions, PER_PAGE);
    let html = "";

    // Worksheet pages
    pagesQ.forEach((pageItems, pageIdx) => {
      html += `
        <div class="sheet">
          <div class="student-header">
            <div class="student-title">Multiply and divide by tens</div>
            <div class="student-fields">
              <span>Name: <span class="line"></span></span>
              <span>Date: <span class="line" style="min-width:120px;"></span></span>
            </div>
          </div>

          <div class="sheet-title">
            <span>Worksheet</span>
            <span class="meta">${escapeHtml(levelText)} • ${n} questions • Page ${pageIdx + 1}/${pagesQ.length}</span>
          </div>

          <div class="grid-2x6">
      `;

      pageItems.forEach((q, idx) => {
        const globalNum = pageIdx * PER_PAGE + idx + 1;
        html += `
          <div class="q">
            <div class="q-top">
              <div class="q-num">${globalNum}.</div>
              <div class="pv-mini-wrap">${renderPV(q.pvVal)}</div>
            </div>
            <div class="expr">
              ${
                q.displayParts.kind === "endBox"
                  ? `<span>${escapeHtml(q.displayParts.leftText)}</span><span class="box" aria-hidden="true"></span>`
                  : `<span class="box" aria-hidden="true"></span><span>${escapeHtml(q.displayParts.midText)}</span>`
              }
            </div>
          </div>
        `;
      });

      const missing = PER_PAGE - pageItems.length;
      for (let i = 0; i < missing; i++) html += `<div class="q" style="visibility:hidden;"></div>`;

      html += `</div></div>`;
    });

    // Answer key pages
    pagesQ.forEach((pageItems, pageIdx) => {
      html += `
        <div class="sheet">
          <div class="sheet-title">
            <span>Answer Key</span>
            <span class="meta">${escapeHtml(levelText)} • ${n} answers • Page ${pageIdx + 1}/${pagesQ.length}</span>
          </div>

          <div class="grid-2x6">
      `;

      pageItems.forEach((q, idx) => {
        const globalNum = pageIdx * PER_PAGE + idx + 1;
        const ans = formatNumber(q.answer);

        html += `
          <div class="q">
            <div class="q-top">
              <div class="q-num">${globalNum}.</div>
              <div class="pv-mini-wrap">${renderPV(q.pvVal)}</div>
            </div>
            <div class="expr">
              ${
                q.displayParts.kind === "endBox"
                  ? `<span>${escapeHtml(q.displayParts.leftText)}</span><span class="answer-pill">${escapeHtml(ans)}</span>`
                  : `<span class="answer-pill">${escapeHtml(ans)}</span><span>${escapeHtml(q.displayParts.midText)}</span>`
              }
            </div>
          </div>
        `;
      });

      const missing = PER_PAGE - pageItems.length;
      for (let i = 0; i < missing; i++) html += `<div class="q" style="visibility:hidden;"></div>`;

      html += `</div></div>`;
    });

    pages.innerHTML = html;
  }

  function resetUI(){
    pages.innerHTML = `
      <div class="empty-state">
        Choose a level and number of questions, then click <strong>Generate worksheet</strong>.
      </div>
    `;
  }

  genBtn.addEventListener("click", () => {
    const mode = levelSel.value;
    const count = parseInt(countInput.value, 10);
    renderSheets(mode, isFinite(count) ? count : 24);
  });

  printBtn.addEventListener("click", () => window.print());

  resetBtn.addEventListener("click", () => {
    levelSel.value = "ten";
    countInput.value = "24";
    resetUI();
  });

  resetUI();
</script>
</body>
</html>
